# Integration test configuration for loan-service
# Uses Testcontainers PostgreSQL â€” datasource URL overridden dynamically

spring:
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        default_schema: application
  flyway:
    enabled: true
    locations: classpath:db/migration
    schemas: application
    baseline-on-migrate: true

  # Disable ALL infrastructure auto-configs that need external services
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration
      - org.flowable.spring.boot.eventregistry.EventRegistryAutoConfiguration
      - org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisHealthContributorAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisReactiveHealthContributorAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.amqp.RabbitHealthContributorAutoConfiguration

# Flowable configuration for tests
flowable:
  process:
    definition-cache-limit: 0
  database-schema-update: true
  history-level: audit
  async-executor-activate: false

# Disable assignment for integration tests (no Keycloak)
loanflow:
  assignment:
    enabled: false
  customer-service:
    url: http://localhost:0
  document-service:
    url: http://localhost:0

server:
  port: 0

logging:
  level:
    com.loanflow: DEBUG
    org.springframework.test: INFO
    org.testcontainers: INFO
    org.flowable: WARN
