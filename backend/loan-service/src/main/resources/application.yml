spring:
  application:
    name: loan-service

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:loan_db}
    username: ${DB_USER:loanflow}
    password: ${DB_PASSWORD:loanflow_secret}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
        default_schema: application
        jdbc:
          time_zone: UTC

  flyway:
    enabled: true
    locations: classpath:db/migration
    schemas: application
    baseline-on-migrate: true

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/loanflow}
          jwk-set-uri: ${KEYCLOAK_JWK_URI:http://localhost:8180/realms/loanflow/protocol/openid-connect/certs}

  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:loanflow}
    password: ${RABBITMQ_PASSWORD:loanflow_secret}

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:loanflow_secret}

# Flowable BPMN Workflow Engine
flowable:
  database-schema-update: true
  history-level: audit
  async-executor-activate: true
  cmmn:
    enabled: false
  dmn:
    enabled: false
  idm:
    enabled: false
  app:
    enabled: false

# US-016: CIBIL Credit Bureau Integration
loanflow:
  cibil:
    base-url: ${CIBIL_BASE_URL:https://uat-api.cibil.com/v2}
    member-code: ${CIBIL_MEMBER_CODE:LOANFLOW-DEV}
    security-code: ${CIBIL_SECURITY_CODE:dev-secret}
    timeout-ms: ${CIBIL_TIMEOUT_MS:30000}
    max-retries: ${CIBIL_MAX_RETRIES:3}
    retry-delay-ms: ${CIBIL_RETRY_DELAY_MS:1000}
    cache-ttl-hours: ${CIBIL_CACHE_TTL_HOURS:24}
    enabled: ${CIBIL_ENABLED:true}

  # US-017: Income Verification (ITR, GST, Bank Statement)
  income-verification:
    base-url: ${INCOME_VERIFICATION_BASE_URL:https://uat-api.incometax.gov.in/v1}
    timeout-ms: ${INCOME_VERIFICATION_TIMEOUT_MS:30000}
    max-retries: ${INCOME_VERIFICATION_MAX_RETRIES:3}
    retry-delay-ms: ${INCOME_VERIFICATION_RETRY_DELAY_MS:1000}
    cache-ttl-hours: ${INCOME_VERIFICATION_CACHE_TTL_HOURS:48}
    enabled: ${INCOME_VERIFICATION_ENABLED:true}

  # US-014: Task Assignment & Escalation
  assignment:
    enabled: true
    strategy: ROUND_ROBIN
    sla-enabled: true
    sla-check-interval-ms: 300000
    officers:
      LOAN_OFFICER:
        - "3d4c6e4e-582e-45bf-b4f8-844e76cfd8db"   # officer@loanflow.com
        - "842fec11-14f7-4378-885c-a8c3dfcf1bfe"   # officer2@loanflow.com
      UNDERWRITER:
        - "c896cf46-1352-4b15-abc8-5de774a13113"   # underwriter@loanflow.com
      SENIOR_UNDERWRITER:
        - "78861730-c75b-4cd6-b6d1-f5395136e492"   # senior.uw@loanflow.com
      BRANCH_MANAGER:
        - "9a3c6949-7398-40bc-a512-1d049f43b9da"   # manager@loanflow.com
    sla:
      documentVerification:
        timeout-hours: 24
        escalate-to: SENIOR_UNDERWRITER
      underwritingReview:
        timeout-hours: 48
        escalate-to: BRANCH_MANAGER
      referredReview:
        timeout-hours: 72
        escalate-to: BRANCH_MANAGER

server:
  port: ${SERVER_PORT:8081}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when_authorized
  metrics:
    tags:
      application: ${spring.application.name}

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true

logging:
  level:
    root: INFO
    com.loanflow: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE

---
spring:
  config:
    activate:
      on-profile: dev

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

---
spring:
  config:
    activate:
      on-profile: staging

  jpa:
    hibernate:
      ddl-auto: validate

logging:
  level:
    root: INFO
    com.loanflow: INFO
    org.hibernate.SQL: WARN

---
spring:
  config:
    activate:
      on-profile: prod

  jpa:
    hibernate:
      ddl-auto: none

logging:
  level:
    root: WARN
    com.loanflow: INFO

---
spring:
  config:
    activate:
      on-profile: uat

security:
  enabled: false
